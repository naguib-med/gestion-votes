let myToken;var userLogin;let indexTemplate,ballotTemplate,nameCandidat,ballotId,nameChanged,isVoted=!1;function routage(e){$("section").each(function(){$(this).hide()}),$(e).show()}function retour(){$("#havedConnected").hide(),$("#index").show(),location.hash="index",routage(location.hash)}async function loginFunct(){let e=document.getElementById("adminForm"),t={method:"POST",mode:"cors",credentials:"same-origin",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify({login:$("#loginForm").val(),nom:$("#nomForm").val(),admin:e.checked})};!function(){"use strict";var e=document.querySelectorAll(".needs-validation");Array.prototype.slice.call(e).forEach(function(e){e.addEventListener("submit",async function(n){e.checkValidity()?await fetch("https://192.168.75.56/api/v3/users/login",t).then(e=>{let t,n;if(e.ok){t=$("#loginForm").val();let i={view:{myName:n=$("#nomForm").val()}};var o=$("#nameCompte").html(),a=Mustache.render(o,i);$("#UserName").html(a),userLogin=t,myToken=e.headers.get("Authorization").replace("Bearer ","");const s={method:"get",headers:new Headers({"Content-Type":"application/json",Authorization:myToken})};if(fetch("https://192.168.75.56/api/v3/election/ballots/byUser/"+userLogin,s).then(e=>{e.ok&&(isVoted=!0)}).catch(function(e){alert("Il y a eu un problème avec l'opération fetch: "+e.message,"danger")}),!1===isVoted)document.getElementById("affVote").innerHTML="You have not yet voted.";else document.getElementById("affVote").innerHTML="It's the information of your vote.";routage(location.hash="index"),$("#index").show(),$("#connect").hide(),$("#ifNotConnected").hide(),$("#ifConnected").show(),showNamesCandidats()}else alert("an error occurred while connecting. Try Again !","warning")}).catch(function(e){alert("Il y a eu un problème avec l'opération fetch: "+e.message,"danger")}):(n.preventDefault(),n.stopPropagation()),e.classList.add("was-validated")},!1)})}()}function showNamesCandidats(){fetch("https://192.168.75.56/api/v3/election/candidats/noms").then(e=>{e.ok&&e.json().then(e=>{let t={listcandidat:e};var n=$("#template_cand").html(),o=Mustache.render(n,t);$("#mypanel_cand").html(o);var a=$("#template_nom").html(),i=Mustache.render(a,t);$("#mypanel_nom").html(i)})}).catch(function(e){alert("Il y a eu un problème avec l'opération fetch: "+e.message,"danger")})}function getUser(){const e={method:"get",headers:new Headers({Accept:"application/json",Authorization:myToken})};fetch("https://192.168.75.56/api/v3/users/"+userLogin,e).then(e=>{console.log(myToken),e.ok?e.json().then(function(e){console.log(e),location.hash="monCompte";var t={infoUser:e},n=$("#compteList").html(),o=Mustache.render(n,t);$("#myPanelCompte").html(o)}):401===e.status?alert("You must log in !","warning"):403===e.status?alert("User not administrator or not logged in","warning"):404===e.status&&alert("User not found","warning")}).catch(function(e){alert("Il y a eu un problème avec l'opération fetch: "+e.message,"danger")})}function afficheCand(e){nameCandidat=e.getAttribute("href").split("/")[1],console.log(nameCandidat);const t={method:"get",headers:new Headers({"Content-Type":"application/json",Authorization:myToken})};fetch("https://192.168.75.56/api/v3/election/candidats/"+nameCandidat,t).then(e=>{e.ok?(console.log(e),e.json().then(e=>{console.log(e);let t={nomsCandidat:e};var n=$("#template_afficheC").html(),o=Mustache.render(n,t);$("#infoCandidat").html(o)})):401===e.status?(console.log("connectez vous"),$("#candidat").hide(),alert("You must log in !","warning")):404===e.status&&alert("User not found","warning")}).catch(function(e){alert("Il y a eu un problème avec l'opération fetch: "+e.message,"danger")})}function logout(){const e={method:"post",headers:new Headers({"Content-Type":"application/json",Authorization:myToken})};fetch("https://192.168.75.56/api/v3/users/logout",e).then(e=>{e.ok&&(myToken=void 0,userLogin=void 0,location.hash="index",$("#ifConnected").hide(),$("#ifNotConnected").show(),$("#connect").show(),$("#loginForm").val(""),$("#nomForm").val(""))}).catch(function(e){alert("Il y a eu un problème avec l'opération fetch: "+e.message,"danger")})}function vote(){!0===isVoted?($("#voteConfirmationModal").modal("hide"),$("#VoteModal").modal("show")):($("#VoteModal").modal("hide"),$("#voteConfirmationModal").modal("show"))}function voteFunct(){if(!1===isVoted){let e,t=[],n={method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:myToken}),body:JSON.stringify({nomCandidat:$("#candidatBy").val()})};fetch("https://192.168.75.56/api/v3/election/resultats").then(e=>{e.ok&&e.json().then(e=>{for(let n=0;n<e.length;n++)t[n]=e[n];var n={listElection:e},o=$("#mp_template").html(),a=Mustache.render(o,n);$("#mypanel").html(a)})}).catch(function(e){alert("Il y a eu un problème avec l'opération fetch: "+e.message,"danger")}),fetch("https://192.168.75.56/api/v3/election/ballots",n).then(n=>{if(n.ok){e=$("#candidatBy").val();for(let n=0;n<t.length;n++)t[n].nomCandidat===e&&(t[n].votes+=1);isVoted=!0,alert("Nice, your vote has been registered successfully !","success"),getBallotByUser()}else 400===n.status?alert("Unacceptable query parameters","warning"):401===n.status&&alert("You must log in !","warning")}).catch(function(e){alert("Il y a eu un problème avec l'opération fetch: "+e.message,"danger")})}else $("#VoteModal").modal("show")}function getBallotByUser(){if(!0===isVoted){const e={method:"get",headers:new Headers({"Content-Type":"application/json",Authorization:myToken})};document.getElementById("affVote").innerHTML="It's the information of your vote.",fetch("https://192.168.75.56/api/v3/election/ballots/byUser/"+userLogin,e).then(e=>{e.ok?(isVoted=!0,e.json().then(e=>{ballotId=e.id.split("/")[2];var t={infoVote:{votant:e.votant,id:e.id.split("/")[2]}},n=$("#template_vote").html(),o=Mustache.render(n,t);$("#myPanelVote").html(o)})):401===e.status?alert("You must log in !","warning"):403===e.status?alert("You cannot consult because you are neither an administrator nor an owner of the vote","warning"):404===e.status&&alert("User or ballot not found","warning")}).catch(function(e){alert("Il y a eu un problème avec l'opération fetch: "+e.message,"danger")})}else{console.log("ca doit s afficher"),document.getElementById("affVote").innerHTML="You have not yet voted."}}function changeName(){$("#newName").keyup(function(e){$("#nameUser").text($(this).val()),nameChanged=$(this).val(),13===e.keyCode&&(e.preventDefault(),document.getElementById("myBtn").click())}),$("#changeName").keyup(function(){$("#nameUser").text($(this).val()),nameChanged=$(this).val()})}function alert(e,t){let n=document.createElement("div");n.innerHTML='<div class="alert alert-'+t+' alert-dismissible" role="alert">'+e+'<button type="button" class="btn-close" data-mdb-dismiss="alert" aria-label="Close"></button></div>',document.getElementById("liveAlertPlaceholder").append(n)}function updateName(){const e={method:"put",headers:new Headers({"Content-Type":"application/json",Authorization:myToken}),body:JSON.stringify({nom:nameChanged})};fetch("https://192.168.75.56/api/v3/users/"+userLogin+"/nom",e).then(e=>{e.ok?(console.log("modifié"),alert("Nice, your name has been successfully changed !","success")):400===e.status?alert("Unacceptable request parameters","warning"):401===e.status?alert("You must log in !","warning"):403===e.status?alert("User not administrator or not logged in","warning"):404===e.status&&alert("User not found","warning")}).catch(function(e){alert("Il y a eu un problème avec l'opération fetch: "+e.message,"danger")})}function deleteVote(){!1!==isVoted?($("#noVoteModal").modal("hide"),$("#deleteModal").modal("show")):($("#deleteModal").modal("hide"),$("#noVoteModal").modal("show"))}function deleteVoteUser(){const e={method:"delete",headers:new Headers({"Content-Type":"application/json",Authorization:myToken})};fetch("https://192.168.75.56/api/v3/election/ballots/"+ballotId,e).then(e=>{if(204===e.status){isVoted=!1;var t=$("#template_vote").html(),n=Mustache.render(t,"");$("#myPanelVote").html(n),alert("Nice, your vote has been deleted successfully !","success"),document.getElementById("affVote").innerHTML="You have not yet voted."}else 401===e.status?alert("You must log in !","warning"):403===e.status?alert("User not administrator or not owner of the vote","warning"):404===e.status&&alert("Vote not found","warning")}).catch(function(e){alert("Il y a eu un problème avec l'opération fetch: "+e.message,"danger")})}$(window).bind("load",()=>{indexTemplate=$("#index").prop("innerHTML"),ballotTemplate=$("#template_vote").prop("innerHTML"),routage(location.hash),showNamesCandidats(),myToken?myToken&&($("#ifNotConnected").hide(),$("#ifConnected").show(),$("#delete").hide()):(location.hash="index",$("#ifConnected").hide(),$("#ifNotConnected").show())}),$(window).bind("hashchange",()=>{let e=location.hash.split("/")[0];if("#candidat"!==e){if(showNamesCandidats(),!myToken&&"index"===location.hash)return $("#connect").show(),$("#vote").hide(),$("#ballot").hide(),$("#deco").hide(),$("#candidats").hide(),void $("#delete").hide();if(myToken&&"#ballot"===e&&($("#havedConnected").hide(),$("#ballot").show()),!myToken&&"#ballot"===e)return $("#index").hide(),void $("#havedConnected").show();if(myToken&&"#vote"===e&&($("#havedConnected").hide(),$("#vote").show()),!myToken&&"#vote"===e)return $("#index").hide(),void $("#havedConnected").show();myToken&&"#monCompte"===e&&($("#havedConnected").hide(),$("#monCompte").show()),myToken||"#monCompte"!==e?routage(location.hash):($("#index").hide(),$("#havedConnected").show())}else routage(location.hash.split("/")[0])}),setInterval(function(){fetch("https://192.168.75.56/api/v3/election/resultats").then(e=>{e.ok&&e.json().then(e=>{let t={listElection:e};var n=$("#mp_template").html(),o=Mustache.render(n,t);$("#mypanel_election").html(o)})}).catch(function(e){alert("Il y a eu un problème avec l'opération fetch: "+e.message,"danger")})},3e3);